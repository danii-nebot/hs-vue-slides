<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Session 4 | M5 - THE VUE ECOSYSTEM</title>

		<meta name="description" content="M5 - THE VUE ECOSYSTEM | session 4">
		<meta name="author" content="Dani Nebot">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="../../dist/reset.css">
		<link rel="stylesheet" href="../../dist/reveal.css">
		<link rel="stylesheet" href="../../dist/theme/harbour.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../../plugin/highlight/monokai.css">
	</head>

	<body>
		<div class="header">
			<a href="../../index.html">
				<svg class="harbour-logo" height="26" viewBox="0 0 270 26" width="270"><path d="m269.359 21.241v3.536h-15.158v-23.573h15.125v3.538h-11.084v6.533h9.5v3.366h-9.5v6.602zm-28.902 4.04c-5.83 0-9.164-3.098-9.164-8.484v-7.609c0-5.387 3.334-8.487 9.164-8.487 2.492 0 4.547.674 6.197 2.056 1.65 1.378 2.492 3.4 2.492 6.094v.337h-4.041v-.337c0-1.449-.474-2.559-1.449-3.3-.977-.776-2.055-1.146-3.234-1.146-3.402 0-5.086 1.651-5.086 4.514v8.147c0 2.86 1.684 4.514 5.086 4.514 1.18 0 2.258-.371 3.234-1.112.977-.774 1.449-1.887 1.449-3.336v-.335h4.041v.335c0 2.696-.842 4.718-2.492 6.097-1.65 1.38-3.705 2.052-6.197 2.052zm-18.26-6.329h-8.893l-2.121 5.825h-3.74v-1.347l8.422-22.227h3.975l8.422 22.227v1.348h-3.975zm-4.412-12.357-3.268 8.991h6.469zm-17.484 9.093h-6.164v9.09h-4.043v-23.574h10.207c4.143 0 6.635 2.799 6.635 7.242 0 4.446-2.493 7.242-6.635 7.242zm-.707-10.946h-5.457v7.409h5.457c1.854 0 3.234-1.314 3.234-3.705 0-2.389-1.381-3.704-3.234-3.704zm-22.84 6.297.471.168c1.281.438 2.293.843 3.033 1.18.773.335 1.549.775 2.393 1.345 1.648 1.11 2.39 2.593 2.39 4.58 0 4.142-3.164 6.97-8.924 6.97-2.63 0-4.818-.706-6.57-2.087-1.717-1.413-2.594-3.436-2.594-6.062h4.043c0 1.112.303 1.989.875 2.696 1.213 1.381 2.729 1.752 4.479 1.752 2.83 0 4.414-1.28 4.414-3.065 0-.842-.371-1.48-1.111-1.92-.741-.471-2.09-1.078-4.043-1.816l-.305-.102-.539-.203c-2.559-.977-4.41-1.919-5.522-2.829-1.113-.943-1.649-2.29-1.649-4.073 0-2.055.741-3.738 2.258-4.985 1.514-1.246 3.604-1.886 6.229-1.886 5.287 0 8.758 2.526 8.758 7.948h-4.041c0-2.964-2.021-4.244-4.75-4.244-2.661 0-4.379 1.212-4.379 2.862 0 .91.336 1.617 1.043 2.054.705.44 2.053 1.009 4.041 1.717zm-30.959 4.68h-4.648v9.059h-4.043v-23.574h10.14c4.582 0 7.108 2.663 7.108 7.242 0 3.132-1.416 5.623-4.145 6.803l4.412 8.183v1.346h-3.973zm4.445-7.205c0-2.527-1.246-3.772-3.738-3.772h-5.355v7.544h5.355c2.492 0 3.738-1.248 3.738-3.772zm-27.791 16.767c-2.729 0-4.916-.706-6.535-2.154-1.582-1.445-2.393-3.466-2.393-6.025v-15.896h4.044v16.096c0 2.458 1.751 4.278 4.884 4.278s4.885-1.82 4.885-4.278v-16.096h4.041v15.896c0 2.561-.808 4.58-2.424 6.025-1.584 1.448-3.773 2.154-6.502 2.154zm-23.242.001c-5.693 0-9.266-3.198-9.266-8.485v-7.61c0-5.287 3.572-8.486 9.266-8.486s9.262 3.199 9.262 8.486v7.61c0 5.287-3.569 8.485-9.262 8.485zm5.221-16.297c0-2.661-1.854-4.581-5.221-4.581-3.37 0-5.223 1.919-5.223 4.581v8.015c0 2.661 1.853 4.58 5.223 4.58 3.367 0 5.221-1.919 5.221-4.58zm-25.266 15.792h-10.847v-23.573h9.939c4.209 0 6.736 2.157 6.736 6.333 0 2.391-.943 4.042-2.828 5.017 2.491.91 3.737 2.795 3.737 5.692 0 4.274-2.459 6.531-6.737 6.531zm-1.582-20.035h-5.222v6.566h5.222c2.222 0 3.334-1.11 3.334-3.3s-1.112-3.266-3.334-3.266zm.908 9.935h-6.13v6.564h6.13c2.258 0 3.369-1.078 3.369-3.232 0-2.222-1.111-3.332-3.369-3.332zm-23.715 1.042h-4.648v9.059h-4.043v-23.574h10.139c4.582 0 7.108 2.663 7.108 7.242 0 3.132-1.415 5.623-4.144 6.803l4.414 8.183v1.346h-3.976zm4.447-7.205c0-2.527-1.247-3.772-3.738-3.772h-5.356v7.544h5.356c2.491 0 3.738-1.248 3.738-3.772zm-22.907 10.438h-8.893l-2.122 5.825h-3.74v-1.347l8.422-22.226h3.975l8.421 22.228v1.346h-3.975zm-4.413-12.357-3.267 8.991h6.467zm-18.09 8.148h-9.77v10.034h-4.04v-23.573h4.041v10.002h9.77v-10.002h4.041v23.573h-4.042z"></path><circle cx="161.555" cy="24.745" r="1.256"></circle></svg>
			</a>
		</div>

		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h3>M5 - THE VUE ECOSYSTEM</h3>
					<p>
						<a href="https://harbour.space/faculty/Dani-Nebot">Dani Nebot</a>
					</p>
				</section>
				<section>
					<h3>session 4</h3>
					<p><small>Nuxt Advanced Features</small></p>
				</section>
        <section>
          <section data-markdown="">
          ### Route middleware

          Middleware are **navigation guards** that receive the current route and the next route as arguments.

          Middleware has the ability to **stop** or **redirect** navigation, using the helpers:
          - navigateTo
          - abortNavigation
          </section>
          <section data-markdown="">
          #### Route middleware implementation

          Middleware reside in the `/middleware` directory.

          `defineNuxtRouteMiddleware` creates the middleware function

          </section>
          <section data-markdown="">
          #### Route middleware implementation /2
          After performing its logic, possible return values are:

          - nothing, con continue navigation (or to the next middleware function)
          - return navigateTo(path): redirects to the given path and will set the redirect code to 302 Found on the server side
          - Similarly, return navigateTo('/', { redirectCode: 301 })
          - return abortNavigation(err?) will throw an error (404 by default)
          </section>

          <section data-markdown="">
          #### Middleware simple example

          ```
          // middleware/auth.ts
          export default defineNuxtRouteMiddleware((to, from) => {
            if (isAuthenticated() === false) {
              return navigateTo('/login')
            }
          })
          ```
          </section>
          <section data-markdown="">
            #### Global middleware

            Placed in the middleware/ directory with a **.global** suffix, for example:

            middleware/myMiddleware.global.ts

            They will be automatically run on every route change.
          </section>
          <section data-markdown="">
          #### How to use Middleware

          The route middleware name is normalized to kebab-case, so myMiddleware name will actually be my-middleware

          ```
          &lt;script setup>
            definePageMeta({
              middleware: 'my-middleware'
            })
            &lt;/script>
          ```

          </section>


          <section data-markdown="">
            #### Inline middleware

            Middleware can also be defined inline inside our page using an anonymous function:

            ```
            definePageMeta({
              middleware: () => {
                console.log('Strictly forbidden.')
                return abortNavigation()
              }
            })
            ```
          </section>
          <section data-markdown="">
          #### Route Validation

          For simple scenarios, we can also use the **validate** property in definePageMeta

          The validate property accepts the route as an argument.

          Possible return values:
          - true: continue navigation
          - false: error 404 thrown
          - Error object with statusCode / statusMessage
          </section>
          <section data-markdown="">
          #### Route Validation Usecase
          ```
          definePageMeta({
            validate: async (route) => {
              // Check if the id is made up of digits
              return /^\d+$/.test(route.params.id)
            }
          })
          ```
          </section>
        </section>
        <section>
          <section data-markdown="">
          ### Fetching Async data

          Nuxt provides several methods and composables to fetch asynchronous data from any URL:

          $fetch, useFetch, useLazyFetch, useAsyncData and useLazyAsyncData
          </section>
          <section data-markdown="">
          #### $fetch

          It's a wrapper over the native **fetch** api we are already familiar, with two benefits:
          - It will handle 'smartly' making direct API calls if it's running on the server, or making a client-side call to your API if it's running on the client.
          - Convenience features including automatically parsing responses and stringifying data.
          </section>
          <section data-markdown="">
            #### $fetch Exercise

            Choose your favorite API (or https://yesno.wtf/api) and fetch data asynchronously on your page
          </section>
          <section data-markdown="">
            #### useFetch and useLazyFetch

            useFetch is a convenient wrapper around **useAsyncData** and **$fetch**

            useLazyFetch useFetch with the lazy: true option set.

            Lazy async functions **will not block navigation**
          </section>
          <section data-markdown="">
          #### useFetch Example: script

          ```
          &lt;script setup>
            const { pending, data: posts } = useLazyFetch('/api/posts')
            watch(posts, (newPosts) => {
              // Because posts starts out null, you will not have access
              // to its contents immediately, but you can watch it.
            })
            &lt;/script>
          ```

          </section>
          <section data-markdown="">
            #### useFetch Example: template

            ```
            &lt;template>
              &lt;!-- you will need to handle a loading state -->
              &lt;div v-if="pending">
                Loading ...
              &lt;/div>
              &lt;div v-else>
                &lt;div v-for="post in posts">
                  &lt;!-- do something -->
                &lt;/div>
              &lt;/div>
            &lt;/template>
            ```
          </section>
          <section data-markdown="">
            #### useFetch Exercise

            Fix the previous exercise!
          </section>
          <section data-markdown="">
          #### useAsyncData and useLazyAsyncData

          useAsyncData is used to get access to data **that resolves asynchronously**

          useLazyAsyncData of course will not block navigation

          </section>
          <section data-markdown="">
          #### useAsyncData vs useFetch
          What is the difference between useFetch and useAsyncData?

          useFetch receives a URL and gets that data

          useAsyncData might have more complex logic.

          useFetch(url) is equivalent to:
          ```
          useAsyncData(url, () => $fetch(url))
            ```
          </section>
          <section data-markdown="">

            #### Reloading data

            Throughout the course of your user's page visit, you may need to refresh the data loaded from the API.

            For example, if the user chooses to paginate, filter results, search, etc.

            useFetch() returns a refresh() method to refresh the data with different query parameters
          </section>
          <section data-markdown="">

            #### Reloading data Example

            ```
            <script setup>
              const page = ref(1);
              const { data: users, pending, refresh, error } = await useFetch(() => `users?page=${page.value}&take=6`, { baseURL: config.API_BASE_URL }
              );
              function previous() {
                page.value--;
                refresh();
              }
              function next() {
                page.value++;
                refresh();
              }
              </script>
            ```
          </section>
        </section>
        <section>
          <section data-markdown="">
            ### Intro to server side Nuxt

            Nuxt automatically scans files inside the ~/server/api (and others) to register API and server handlers
          </section>
          <section data-markdown="">
            #### Nuxt API endpoint Example
            ```
            export default defineEventHandler((event) => {
              return {
                api: 'works'
              }
            })
            ```
          </section>
        </section>
      </div>
		</div>

		<script src="../../dist/reveal.js"></script>
		<script src="../../plugin/zoom/zoom.js"></script>
		<script src="../../plugin/notes/notes.js"></script>
		<script src="../../plugin/search/search.js"></script>
		<script src="../../plugin/markdown/markdown.js"></script>
		<script src="../../plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				controls: true,
				progress: true,
				center: true,
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
			});

		</script>

	</body>
</html>

