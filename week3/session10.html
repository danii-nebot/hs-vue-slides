<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Session 10 | M3 - Introduction to Vue.js</title>

		<meta name="description" content="M3 - Introduction to Vue.js | Session 10">
		<meta name="author" content="Dani Nebot">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="../dist/reset.css">
		<link rel="stylesheet" href="../dist/reveal.css">
		<link rel="stylesheet" href="../dist/theme/harbour.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../plugin/highlight/monokai.css">
	</head>

	<body>
		<div class="header">
			<a href="../index.html">
				<svg class="harbour-logo" height="26" viewBox="0 0 270 26" width="270"><path d="m269.359 21.241v3.536h-15.158v-23.573h15.125v3.538h-11.084v6.533h9.5v3.366h-9.5v6.602zm-28.902 4.04c-5.83 0-9.164-3.098-9.164-8.484v-7.609c0-5.387 3.334-8.487 9.164-8.487 2.492 0 4.547.674 6.197 2.056 1.65 1.378 2.492 3.4 2.492 6.094v.337h-4.041v-.337c0-1.449-.474-2.559-1.449-3.3-.977-.776-2.055-1.146-3.234-1.146-3.402 0-5.086 1.651-5.086 4.514v8.147c0 2.86 1.684 4.514 5.086 4.514 1.18 0 2.258-.371 3.234-1.112.977-.774 1.449-1.887 1.449-3.336v-.335h4.041v.335c0 2.696-.842 4.718-2.492 6.097-1.65 1.38-3.705 2.052-6.197 2.052zm-18.26-6.329h-8.893l-2.121 5.825h-3.74v-1.347l8.422-22.227h3.975l8.422 22.227v1.348h-3.975zm-4.412-12.357-3.268 8.991h6.469zm-17.484 9.093h-6.164v9.09h-4.043v-23.574h10.207c4.143 0 6.635 2.799 6.635 7.242 0 4.446-2.493 7.242-6.635 7.242zm-.707-10.946h-5.457v7.409h5.457c1.854 0 3.234-1.314 3.234-3.705 0-2.389-1.381-3.704-3.234-3.704zm-22.84 6.297.471.168c1.281.438 2.293.843 3.033 1.18.773.335 1.549.775 2.393 1.345 1.648 1.11 2.39 2.593 2.39 4.58 0 4.142-3.164 6.97-8.924 6.97-2.63 0-4.818-.706-6.57-2.087-1.717-1.413-2.594-3.436-2.594-6.062h4.043c0 1.112.303 1.989.875 2.696 1.213 1.381 2.729 1.752 4.479 1.752 2.83 0 4.414-1.28 4.414-3.065 0-.842-.371-1.48-1.111-1.92-.741-.471-2.09-1.078-4.043-1.816l-.305-.102-.539-.203c-2.559-.977-4.41-1.919-5.522-2.829-1.113-.943-1.649-2.29-1.649-4.073 0-2.055.741-3.738 2.258-4.985 1.514-1.246 3.604-1.886 6.229-1.886 5.287 0 8.758 2.526 8.758 7.948h-4.041c0-2.964-2.021-4.244-4.75-4.244-2.661 0-4.379 1.212-4.379 2.862 0 .91.336 1.617 1.043 2.054.705.44 2.053 1.009 4.041 1.717zm-30.959 4.68h-4.648v9.059h-4.043v-23.574h10.14c4.582 0 7.108 2.663 7.108 7.242 0 3.132-1.416 5.623-4.145 6.803l4.412 8.183v1.346h-3.973zm4.445-7.205c0-2.527-1.246-3.772-3.738-3.772h-5.355v7.544h5.355c2.492 0 3.738-1.248 3.738-3.772zm-27.791 16.767c-2.729 0-4.916-.706-6.535-2.154-1.582-1.445-2.393-3.466-2.393-6.025v-15.896h4.044v16.096c0 2.458 1.751 4.278 4.884 4.278s4.885-1.82 4.885-4.278v-16.096h4.041v15.896c0 2.561-.808 4.58-2.424 6.025-1.584 1.448-3.773 2.154-6.502 2.154zm-23.242.001c-5.693 0-9.266-3.198-9.266-8.485v-7.61c0-5.287 3.572-8.486 9.266-8.486s9.262 3.199 9.262 8.486v7.61c0 5.287-3.569 8.485-9.262 8.485zm5.221-16.297c0-2.661-1.854-4.581-5.221-4.581-3.37 0-5.223 1.919-5.223 4.581v8.015c0 2.661 1.853 4.58 5.223 4.58 3.367 0 5.221-1.919 5.221-4.58zm-25.266 15.792h-10.847v-23.573h9.939c4.209 0 6.736 2.157 6.736 6.333 0 2.391-.943 4.042-2.828 5.017 2.491.91 3.737 2.795 3.737 5.692 0 4.274-2.459 6.531-6.737 6.531zm-1.582-20.035h-5.222v6.566h5.222c2.222 0 3.334-1.11 3.334-3.3s-1.112-3.266-3.334-3.266zm.908 9.935h-6.13v6.564h6.13c2.258 0 3.369-1.078 3.369-3.232 0-2.222-1.111-3.332-3.369-3.332zm-23.715 1.042h-4.648v9.059h-4.043v-23.574h10.139c4.582 0 7.108 2.663 7.108 7.242 0 3.132-1.415 5.623-4.144 6.803l4.414 8.183v1.346h-3.976zm4.447-7.205c0-2.527-1.247-3.772-3.738-3.772h-5.356v7.544h5.356c2.491 0 3.738-1.248 3.738-3.772zm-22.907 10.438h-8.893l-2.122 5.825h-3.74v-1.347l8.422-22.226h3.975l8.421 22.228v1.346h-3.975zm-4.413-12.357-3.267 8.991h6.467zm-18.09 8.148h-9.77v10.034h-4.04v-23.573h4.041v10.002h9.77v-10.002h4.041v23.573h-4.042z"></path><circle cx="161.555" cy="24.745" r="1.256"></circle></svg>
			</a>
		</div>

		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h3>M3 - Introduction to Vue.js</h3>
					<p>
						<a href="https://harbour.space/faculty/Dani-Nebot">Dani Nebot</a>
					</p>
				</section>

				<section>
					<h3>Session 10</h3>
					<p><small>State management with Pinia</small></p>
				</section>

        <section>
					<section data-markdown="">
            ### Pinia: The official Vue Data Store

            ![](https://pinia.vuejs.org/logo.svg)

          </section>

          <section data-markdown>
            #### What is a Data Store?

            Data Stores hold business logic that is not bound to any one component, so it acts as a **global state**.

            Therefore, Data Stores allow us to easily share a state across components and pages.

            Tipically Stores will not expose the state itself, but work with concepts such as **getters** and **actions**.
          </section>

          <section data-markdown="">
            #### Why use a data Store?

            As you might have noticed during the course, sharing reactive data among multiple
            components can be a challenge.

            **Important: Not all applications need access to a global state!**
          </section>

          <section data-markdown="">
            #### When to use a data Store?

            Data that needs to **accessible accross our application**, (for example: persisted user information),
            as well as data that needs to be **preserved through pages**, (for example: a very complicated multi-step form),
            are classic uses of a shared data store.
          </section>

          <section data-markdown>
            #### Pinia

            Pinia began as an evolution of Vuex (the offical data store for Vue 2), which heavily inspired by Redux originally, incoporating concepts from the new Vue 3 commposition API
            and simplifying the API so it's less verbose and requires less boilerplate code.

            Oh, and Pinia **does away with mutations** - so bye magic strings, enjoy autocomplete!

            [As always, check the docs for more info](https://pinia.vuejs.org/)

          </section>

          <section data-markdown>
            ### What's with the name?
            According to the docs: "**Pinia** is the closest word to pi√±a (pineapple in Spanish) that is a valid **npm package** name"

            And "pineapples are in reality a groupd of inidivual flowers that join together to create a multiple fruit".

            So there's that üçç
          </section>
        </section>

        <section>
          <section data-markdown="">
            ### Using Pinia

            **Pinia** works as a Vue plugin, just like **vue-router**:

            ```
              import { createApp } from 'vue'
              import { createPinia } from 'pinia'
              import App from './App.vue'

              const pinia = createPinia()
              const app = createApp(App)

              app.use(pinia)
              app.mount('#app')
            ```
          </section>
          <section data-markdown="">
            #### Defining the Store

            Looks familiar, doesn't it?

            ```
            export const useCounterStore = defineStore('counter', () => {
              // this is the setup function
              const count = ref(0);
              const doubleCount = computed(() => count.value * 2);
              function increment() {
                count.value++;
              }

              return { count, doubleCount, increment };
            });
            ```

          </section>
          <section data-markdown="">
            #### Using the store in my components

            Never destructure refs directly from the store!
            The **storeToRefs** will create reactive references to state properties.

            It's ok to destructure actions (as they are non reactive)

            ```
            import { storeToRefs } from 'pinia';
            import { useCounterStore } from '@/stores/counter';

            const counterStore = useCounterStore(); // do not destructure refs!
            const { count, doubleCount } = storeToRefs(counterStore);
            const { increment } = counterStore; // destructuring is ok here
            ```

          </section>
          <section data-markdown="">
            #### Subscribing to changes: watch

            As with any reactive value, we can use **watch** to react to changes:

            ```
              import { watch } from 'vue';
              import { storeToRefs } from 'pinia';
              import { useCounterStore } from '@/stores/counter';
              const { count } = storeToRefs(counterStore);
              watch(count, (newCount, oldCount) => {
                console.log('My new count:', newCount, 'changed from', oldCount);
              });
            ```

            And I can use **watch** inside my store too!
          </section>

          <section data-markdown="">
            #### Subscribing to changes: $onAction

            Will trigger when an action (or function in the setup of the store)
            is invoked, providing with us with A LOT of contextual information

          </section>
          <section data-markdown="">
            #### $onAction in action
            ```
            const unsubscribe = someStore.$onAction(
              ({
                name, // name of the action
                store, // store instance, eg `someStore`
                args, // array of parameters passed to the action
                after, // hook after the action returns or resolves
                onError, // hook if the action throws or rejects
              }) => {
                ...
              });

              // manually remove the listener
              // (will be removed automatically on *unmount*)
              unsubscribe();

            ```
          </section>

          <section data-markdown="">
            #### Alternative syntax: Options

            There is an alternative syntax for defining the store that mimics the **Vue
            Options API**

            Instead of a function, it will take an object as the 2nd paramter for **defineStore**:

            ```
            export const useTodos = defineStore('todos', {
              ... // options here
            });
            ```
          </section>
            <section data-markdown="">
              #### state

              A function that returns **reactive variables**.

              Is equivalent to defining **refs** if using setup function.

              ```
                state: () => ({
                  name: 'Dani' // initial value
                  surname: 'Nebot'
                }),
                ```
            </section>
            <section data-markdown="">
              #### getters

              Are the equivalents for **computed** if using setup function.
              ```
              getters: {
                fullName(state) {
                  return state.name + ' ' + state.surname
                },
              },
              ```
            </section>
            <section data-markdown="">
              #### actions

              Are the equivalents for **functions** defined in the setup function.
              They can be async, too!
              ```
              actions: {
                addTodo(text) {
                  // you can directly mutate the state
                  this.todos.push({ text, id: this.nextId++, isFinished: false });
                },
                },
              });
              ```
          </section>
          <section data-markdown="">
            #### $reset and $patch

            Only if defined with *state*, *getters* and *actions*, Pinia exposes the **$reset**
            and **$patch** helpers

            **$reset** will reset the store to its initial value

            **$patch** will apply several changes to the *state* at onces (triggering only one $onAction)
          </section>
          <section data-markdown="">
            #### $patch an Object

            There are two "flavors" of **$patch**. The "simplest" takes an object, applies it to the state:

            ```
            //
            store.$patch({
              count: store.count + 1,
              name: 'Dani',
            })
            ```

          </section>
          <section data-markdown="">
            #### $patch with a Function

            The second option is to pass a function  with the `state` parameter

            Recommended for altering collection states (arrays or objects/dictionaries):

            ```
            store.$patch((state) => {
              state.name = 'Dani'
              state.todoList.push({ text: 'Grade assignments', finished: false })
            })
            ```

          </section>
          <section data-markdown="">
            #### Pinia cheatsheet

            [Check it out here!](https://storage.googleapis.com/vue-mastery.appspot.com/flamelink/media/Pinia-Cheat-Sheet.pdf?GoogleAccessId=firebase-adminsdk-jyioc%40vue-mastery.iam.gserviceaccount.com&Expires=16725225600&Signature=kyMynndU2WMV1ie1HcAdGZkajToy0%2FuvB6xeObn6lTYLy2IRJWZxSqnlbB6P41f83y1lKczNxc5%2FXlk%2B%2B0BZ4zKpPSZAJVveEHzpROesCJ%2BJn%2FDw3tabttXgwwFVzWJC5yAmstJJE%2FNNULCJEmi1%2BOzPW7eyrok0Cg4HIqMhJoGVNp2DiUPZnqoYK71ugiNzMXos5bTk4%2FOwipsxuJeSVOeaD5N2CfDLQAOGNM0dVKCxQseiNUaYaKNe0bbAva9zmlbTlxVYNZlGPw3R0i0gs5WBAQiFHn0OlcQxcFP3F%2BKksqg3%2BHmlORkGDjnbiEdjX9pnZNh%2BqaVgg2p3ICXvQg%3D%3D)
          </section>

          <section data-markdown="">
            #### Practice time!

            From the command line, let's explore a **Vite** project with **Pinia**!

            ```
              npm create vite@latest
            ```
          </section>
				</section>
		</div>

		<script src="../dist/reveal.js"></script>
		<script src="../plugin/zoom/zoom.js"></script>
		<script src="../plugin/notes/notes.js"></script>
		<script src="../plugin/search/search.js"></script>
		<script src="../plugin/markdown/markdown.js"></script>
		<script src="../plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				controls: true,
				progress: true,
				center: true,
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
			});

		</script>

	</body>
</html>
